---

# 변경 감지

## 준영속 엔티티

- 더 이상 영속성 컨텍스트가 관리하지 않는 엔티티를 의미함. ( JPA가 관리를 하지않아 변경을 해도 더티체킹이 X)
![](https://images.velog.io/images/donglee99/post/20ea6e99-29c6-426a-a270-b32053cc88ad/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-05-17%20%EC%98%A4%EC%A0%84%2010.52.37.png)


다음과 같은 경우 book은 준영속 컨텍스트다.

## 변경 감지와 병합

1. 변경 감지 
    - Id 값을 받아와 해당 객체를 findOne(id) 를 통해 영속성 컨텍스트에 들어가게 한후 Set을 통해 값을 설정후 transaction 이 끝나게 되면 자동으로 Flush가 되면서 변경 감지를 하게 되고 이에따라 바뀐 값이 있으면 수정이 된다.
2. Merge(병합)
    - 병합의 경우

![](https://images.velog.io/images/donglee99/post/edc1be9f-78ed-445d-9b2e-d4f61427a0c6/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-05-17%20%EC%98%A4%ED%9B%84%208.56.51.png)
        다음과 같은 방식으로 로직이 진행 되는데

        Merge 를 실행하게 되면 준영속 엔티티의 식별자 값으로 1차 캐시에서 엔티티를 조회 하고 없을경우 DB 에서 조회를 하게된다.

        이후 처음 준영속 엔티티 값을 가져온 값에 밀어 넣은후 반환을 한다.

        이때 문제점은 만약 준영속 엔티티 값에  Null Or 변경하지 않은값 이 있을 경우 Null이 들어 가게 된다.

🖍 변경 감지는 원하는 값만 바꾸는게 가능하지만 병합의 경우 그렇지 않다.

따라서 병합은 사용을 지양하자.